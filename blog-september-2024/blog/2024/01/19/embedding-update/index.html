<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tauri update: embedding prototype, offscreen rendering, multiple webviews, and more! - Servo, the embeddable, independent, memory-safe, modular, parallel web rendering engine</title>
  <meta property="og:title" content="Tauri update: embedding prototype, offscreen rendering, multiple webviews, and more! - Servo, the embeddable, independent, memory-safe, modular, parallel web rendering engine">
  

  
  <meta name="description" content="Overview of the embedding improvements we’ve landed as part of our collaboration with Tauri.">
  <meta name="og:description" content="Overview of the embedding improvements we’ve landed as part of our collaboration with Tauri.">
  
  <meta name="keywords" content="servo, servo engine, servo rendering engine, web engine, web rendering engine, web browser, web browser engine, rust">
  <meta name="author" content="The Servo Project Developers">

  <meta property="og:site_name" content="Servo">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/blog-september-2024/img/servo-color-positive.png">
  <meta property="og:image:alt" content="Servo logo">
  <meta property="og:logo" content="/blog-september-2024/img/servo-symbol-color-no-container.png">
  <meta property="og:url" content="/blog-september-2024/blog/2024/01/19/embedding-update/">

  <link rel="stylesheet" href="/blog-september-2024/css/style.css">
  <link rel="shortcut icon" href="/blog-september-2024/img/servo-symbol-color-no-container.png">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <link rel="alternate" href="/blog-september-2024/blog/feed.xml" title="Servo Blog" type="application/atom+xml">
</head>

  <body class="is-page">
    <main class="is-main">
      <nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/blog-september-2024/">
        <img src="/blog-september-2024/img/servo-color-negative-no-container.png" alt="Tauri update: embedding prototype, offscreen rendering, multiple webviews, and more!">
      </a>

      <a role="button" class="navbar-burger" data-target="navbar-menu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div class="navbar-menu" id="navbar-menu">
      
        
        
          
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link
            
              
            
              
            
              
            
              
            
          " href="#">
              Get Involved
            </a>
            <div class="navbar-dropdown">
              
                <a class="navbar-item" href="/blog-september-2024/contributing/">
                  Contributing
                </a>
              
                <a class="navbar-item" href="https://book.servo.org" target="_blank">
                  Servo Book
                </a>
              
                <a class="navbar-item" href="https://wpt.servo.org/" target="_blank">
                  WPT pass rates
                </a>
              
                <a class="navbar-item" href="/blog-september-2024/coc/">
                  Code of Conduct
                </a>
              
            </div>
          </div>
        
      
        
        
          <a class="navbar-item" href="/blog-september-2024/download/">
            Download
          </a>
        
      
        
        
          <a class="navbar-item" href="/blog-september-2024/blog/">
            Blog
          </a>
        
      
        
        
          <a class="navbar-item" href="https://demo.servo.org/" target="_blank">
            Demos
          </a>
        
      
        
        
          
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link
            
              
            
              
            
              
            
              
            
          " href="#">
              About
            </a>
            <div class="navbar-dropdown">
              
                <a class="navbar-item" href="/blog-september-2024/about/">
                  About Servo
                </a>
              
                <a class="navbar-item" href="/blog-september-2024/governance/">
                  Governance
                </a>
              
                <a class="navbar-item" href="/blog-september-2024/sponsorship/">
                  Sponsorship
                </a>
              
                <a class="navbar-item" href="/blog-september-2024/acknowledgements/">
                  Acknowledgements
                </a>
              
            </div>
          </div>
        
      
      <div class="navbar-end">
  
    <div class="navbar-item">
      <a class="button is-github-color" href="https://github.com/servo/servo">
        <span class="icon"><i class="fab fa-github"></i></span>
        <span>GitHub</span>
      </a>
    </div>
  
    <div class="navbar-item">
      <a class="button is-mastodon-color" href="https://floss.social/@servo" rel="me">
        <span class="icon"><i class="fab fa-mastodon"></i></span>
        <span>Mastodon</span>
      </a>
    </div>
  
    <div class="navbar-item">
      <a class="button is-twitter-color" href="https://twitter.com/ServoDev">
        <span class="icon"><i class="fab fa-twitter"></i></span>
        <span>Twitter</span>
      </a>
    </div>
  
</div>

    </div>
  </div>
</nav>

      <section class="section" style="padding-top: 0;">
        <div class="container">
          <aside class="menu box">
            <p class="menu-label">
              Tauri update: embedding prototype, offscreen rendering, multiple webviews, and more!
            </p>
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
          </aside>
          <div class="content">
            
<h1 class="title">Tauri update: embedding prototype, offscreen rendering, multiple webviews, and more!</h1>
<p class="subtitle"><span class="tag is-dark">2024-01-19</span> Overview of the embedding improvements we’ve landed as part of our collaboration with Tauri.</p>

<div class="has-top-margin">
  <p><a href="/blog-september-2024/blog/2023/11/30/embedding-floats-color-mix/">Back in November</a>, we highlighted our ongoing efforts to make Servo more embeddable, and today we are a few steps closer!</p>
<p><a href="https://tauri.app">Tauri</a> is a framework for building desktop apps that combine a web frontend with a Rust backend, and work is already ongoing to expand it to mobile apps and other backend languages.
But unlike say, Electron or React Native, Tauri is both engine-agnostic and frontend-agnostic, allowing you to use any frontend tooling you like and whichever web engine makes the most sense for your users.</p>
<p>To integrate Servo with Tauri, we need to add <strong>support for Servo in <a href="https://github.com/tauri-apps/wry">WRY</a></strong>, the underlying webview library, and the developers of Tauri have created a proof of concept doing exactly that!
While this is definitely not production-ready yet, you can play around with it by checking out the <a href="https://github.com/tauri-apps/wry/tree/servo-wry-demo">servo-wry-demo</a> branch (<a href="https://github.com/tauri-apps/wry/tree/305220efbe4e8b5813543a7b8f5d8e0a8abb7fbc">permalink</a>) and following the README.</p>
<figure class=_fig id=_wry_demo_fig>
<iframe src="/blog-september-2024/img/blog/embedding-2024-01/demo-with-decorations-too.html"
        id=_wry_demo></iframe>
</figure>
<p>While servoshell, <a href="/blog-september-2024/blog/2023/09/15/upcoming-events-and-new-browser-ui/">our example browser</a>, continues to be the “reference” for embedding Servo, this has its limitations in that servoshell’s needs are often simpler than those of a general-purpose embeddable webview.
For example, the “minibrowser” UI needs the ability to reserve space at the top of the window, and hook the presenting of new frames to do extra drawing, but it doesn’t currently need multiple webviews.</p>
<p>This is where working with the Tauri team has been especially invaluable for Servo — they’ve used their experience integrating with other embeddable webviews to guide changes on the Servo side.
Early changes include making it possible to <strong>position Servo webviews</strong> anywhere within a native window (<a href="https://github.com/wusyong">@wusyong</a>, <a href="https://github.com/servo/servo/pull/30088">#30088</a>), and give them <strong>translucent or transparent backgrounds</strong> (<a href="https://github.com/wusyong">@wusyong</a>, <a href="https://github.com/servo/servo/pull/30488">#30488</a>).</p>
<p>Support for <strong>multiple webviews</strong> in one window is needed for parity with the other WRY backends.
Servo currently has a fairly pervasive assumption that only one webview is active at a time.
We’ve found almost all of the places where this assumption was made (<a href="https://github.com/delan">@delan</a>, <a href="https://github.com/servo/servo/pull/30648">#30648</a>), and now we’re breaking those findings into changes that can actually be reviewed and landed (<a href="https://github.com/delan">@delan</a>, <a href="https://github.com/servo/servo/pull/30840">#30840</a>, <a href="https://github.com/servo/servo/pull/30841">#30841</a>, <a href="https://github.com/servo/servo/pull/30842">#30842</a>).</p>
<p>Support for <strong>multiple windows</strong> sounds similar, but it’s a lot harder.
Servo handles user input and drawing with a component known for historical reasons as the “compositor”.
Since the constellation — the heart of Servo — is currently associated with exactly one compositor, and the compositor is currently tightly coupled with the event loop of exactly one window, supporting multiple windows will require some big architectural changes.
<a href="https://github.com/paulrouget">@paulrouget</a>’s extensive research and prior work on making Servo embeddable will prove especially helpful.</p>
<p><strong>Offscreen rendering</strong> is critical for integrating Servo with apps containing non-Servo components.
For example, you might have a native app that uses Servo for online help or an OAuth flow, or a game that uses Servo for purchases or social features.
We can now draw Servo to an offscreen framebuffer and let the app decide how to present it (<a href="https://github.com/delan">@delan</a>, <a href="https://github.com/servo/servo/pull/30767">#30767</a>), rather than assuming control of the whole window, and servoshell now uses this ability except when the minibrowser is disabled (<code>--no-minibrowser</code>).</p>
<p><strong>Precompiling <a href="https://github.com/servo/mozangle">mozangle</a></strong> and <a href="https://github.com/servo/mozjs"><strong>mozjs</strong></a> would improve developer experience by reducing initial build times.
We can now build the C++ parts of mozangle as a dynamic library (.so/.dylib/.dll) on Linux and macOS (<a href="https://github.com/atbrakhi">@atbrakhi</a>, <a href="https://github.com/servo/mozangle/pull/71">mozangle#71</a>), though more work is needed to distribute and make use of them.</p>
<p>We’re exploring two approaches to precompiling mozjs.
The easier approach is to build the C++ parts as a static library (.a/.lib) and cache the generated Rust bindings (<a href="https://github.com/wusyong">@wusyong</a>, <a href="https://github.com/servo/mozjs/issues/439">mozjs#439</a>).
Building a dynamic library (<a href="https://github.com/atbrakhi">@atbrakhi</a>, <a href="https://github.com/servo/mozjs/pull/432">mozjs#432</a>) will be more difficult, but it should reduce build times even further.</p>
<p>Many thanks to <a href="https://nlnet.nl"><strong>NLnet</strong></a> for <a href="https://nlnet.nl/project/Tauri-Servo/">sponsoring this work</a>.</p>
<style>
    /* guaranteed minimum width for first paragraph after a float */
    ._floatmin {
        display: block;
        width: 13em;
        overflow: hidden;
    }
    ._none {
        display: none;
    }
    ._fig:not(#specificity) {
        width: 33em;
        max-width: 100%;
        margin: 1em auto;
    }
    ._fig > ._flex {
        display: flex;
    }
    ._fig._min {
        width: min-content;
    }
    ._fig table {
        text-align: initial;
    }
    ._fig figcaption._notes {
        text-align: left;
        width: max-content;
        max-width: 100%;
    }
    ._figl:not(#specificity),
    ._figr:not(#specificity) {
        margin: 0 1em 1em;
    }
    ._figl {
        float: left;
    }
    ._figr {
        float: right;
    }
    ._figl > iframe,
    ._figr > iframe,
    ._figl > a > img,
    ._figr > a > img {
        width: 17em;
        max-width: max-content;
    }
    ._figl._default > iframe,
    ._figr._default > iframe,
    ._figl._default > a > img,
    ._figr._default > a > img {
        width: auto;
        max-width: 100%;
    }
    ._runin {
        margin-bottom: 1em;
    }
    ._runin > p,
    ._runin > h2 {
        display: inline;
    }
    ._correction {
        max-width: 33em;
        margin: 1em auto;
        border-bottom: 1px solid;
        padding-bottom: 1em;
    }
    #_wry_demo_fig:not(#specificity) {
        width: 100%;
    }
    #_wry_demo {
        margin: 0 auto;
        display: block;
        height: min(calc(100vh - 9em), 400px);
        width: 100%;
    }
</style>

</div>

<div class="has-top-margin buttons has-addons">
  <a class="button" href="/blog-september-2024/blog/">Back</a>
</div>

          </div>
        </div>
      </section>
    </main>
    <footer class="footer">
  <div class="container" style="text-align: center;">
    <a href="/blog-september-2024/coc/">Code of Conduct</a> |
    Contact: <a href="mailto:info@servo.org">info@servo.org</a>,
    <a href="https://servo.zulipchat.com/">Zulip Chat</a>,
    <a href="https://github.com/servo/servo/discussions">GitHub Discussions</a>,
    <a href="https://floss.social/@servo">Mastodon</a>,
    <a href="https://twitter.com/ServoDev">Twitter</a>
  </div>
  <div class="container" style="text-align: center; font-size: 0.875em;">
    <p><a href="https://linuxfoundation.eu"><img src="/blog-september-2024/img/lf-europe-logo.png" alt="Linux Foundation Europe logo" width="250" style="margin: 1em;"></a></p>
    <p>&copy; 2024 The Servo Project Developers</p>
    <p>Copyright &copy; Servo is a project of <a href="https://linuxfoundation.eu/">Linux Foundation Europe</a>.</p>
    <p>For website terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org">https://lfprojects.org</a>.</p>
  </div>
</footer>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script>
  $(() => {
    const burger = $(".navbar-burger");
    const menu = $(".navbar-menu");
    burger.click(() => {
      [burger, menu].forEach((el) => el.toggleClass('is-active'));
    });
  });
</script>

  </body>
</html>
